# PRD – Photo Color Matching Tool (MVP)

## 1. 제품 개요 (Overview)

본 프로젝트는 기준 사진(A)의 색감 정보를 분석하여 보정 대상 사진(B)에 적용하고,  
보정된 결과 이미지를 저장할 수 있는 **로컬 실행 기반 사진 색감 매칭 도구**를 개발하는 것을 목표로 한다.

MVP 버전에서는 전통적인 색감 매칭(Color Transfer) 기법을 사용하며,  
Python + Streamlit 기반으로 빠르고 안정적인 색감 복제를 제공한다.

---

## 2. 목표 (Goals)

- 기준 사진(A)의 색감을 다른 사진(B)에 자동 적용
- 반복 작업 없이 일관된 색감 보정 제공
- 로컬 환경에서 실행 가능한 간단한 워크플로우
- 향후 기능 확장을 고려한 구조 설계

---

## 3. 비목표 (Non-Goals)

- RAW 파일 현상(Demosaic) 기능
- 전문 상업용 보정툴 수준의 정밀 보정 기능
- AI 기반 스타일 트랜스퍼 (MVP 제외)
- 대용량 이미지(6000px 이상) 성능 최적화 (로드맵)

---

## 4. 사용자 시나리오 (User Flow)

1. 사용자는 기준 색감 사진 A를 업로드한다
2. 사용자는 보정 대상 사진 B를 업로드한다
3. 사용자는 색감 강도를 설정한다
4. 사용자는 변환 실행 버튼을 클릭한다
5. 시스템은 사진 A의 색감을 분석하여 사진 B에 적용한다
6. 보정된 사진 B를 저장한다

---

## 5. 입력 및 출력

### 5.1 입력 이미지
- 지원 포맷: JPG, PNG
- 모든 입력 이미지는 내부 처리 전에 **sRGB 색공간으로 강제 변환**
- HEIC 포맷은 MVP에서 지원하지 않음

### 5.2 출력 이미지
- 원본 해상도 유지
- 저장 위치: `output/` 하위 폴더
- 파일명 규칙: 원본 파일명 + suffix  
  예: `IMG_1234.jpg` → `output/IMG_1234_colorMatched.jpg`

---

## 6. 색감 분석 (Analysis)

- 기준 사진 A를 Lab 색공간으로 변환
- 분석 대상:
  - 전체 픽셀 기준
  - 단, 하이라이트 및 섀도우 영역은 분석에서 제외
- 분석 값:
  - a, b 채널의 통계 정보(평균, 표준편차)
  - L 채널 통계는 로드맵 기능을 위한 확장 고려

---

## 7. 색감 적용 (Color Transfer)

### 7.1 기본 적용 방식 (MVP)
- 사진 B를 Lab 색공간으로 변환
- **a, b 채널만 기준 사진 A의 색감으로 매칭**
- L(명도) 채널은 기본적으로 사진 B의 값을 유지

### 7.2 색감 강도 (Blend)
- 색감 강도 조절 기능 제공 (0–100%)
- 강도는 a, b 채널 적용 비율에 반영

---

## 8. 품질 보호 처리

- 하이라이트 / 섀도우 컷을 통한 색감 분석 안정화
- 결과 값 범위 클리핑(0–255)
- 비정상 색상 발생 최소화

---

## 9. UI / UX

- UI 프레임워크: Streamlit
- 구성:
  - 기준 사진 A 업로드
  - 보정 사진 B 업로드
  - 색감 강도 슬라이더
  - 변환 실행 버튼
- MVP에서는 전/후 미리보기 기능 제외
- 변환 완료 후 저장 위치 안내

---

## 10. 에러 처리

- 잘못된 이미지 입력:
  - 에러 로그 기록
  - 사용자에게 오류 메시지 표시
- 변환 실패:
  - 에러 로그 기록
  - 사용자에게 오류 메시지 표시
- 오류 발생 시 프로그램 중단 후 수정 가능하도록 설계

---

## 11. 기술 스택

- Language: Python 3.x
- Development: VS Code
- Libraries:
  - opencv-python
  - numpy
  - scikit-image
  - Pillow
- UI:
  - Streamlit

---

## 12. 로드맵 (Future Roadmap)

- 사진 A의 L(명도) 값을 사진 B에 **일부 비율로 섞어 적용하는 기능**
- L 적용 비율을 색감 강도 슬라이더와 통합 제어
- 얼굴/피사체 마스킹 기반 색감 분석
- 하이라이트/섀도우 컷 수치 옵션화
- 전/후 미리보기 기능
- 대용량 이미지 대응 전략
- 3D LUT 생성 및 내보내기
- 일괄 처리(폴더 단위)

---

## 13. 성공 기준 (Success Metrics)

- 사용자가 기준 사진 A와 유사한 색감이라고 인지
- 동일 기준 사진 A로 여러 사진 B에 적용 시 결과 일관성 유지
- 로컬 환경에서 안정적으로 실행

---
